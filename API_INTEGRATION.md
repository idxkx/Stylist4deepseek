# Deepseek API 集成指南

本文档提供了如何将您的 Deepseek API 密钥集成到 Stylist4deepseek 穿搭推荐系统中的详细说明。

## Deepseek API 简介

Deepseek 是一个强大的大语言模型，可以用于各种自然语言处理任务。在 Stylist4deepseek 系统中，我们使用 Deepseek 的 API 来生成个性化的穿搭建议，使推荐更加智能和定制化。

## 系统新特性：衣橱内外单品推荐

Stylist4deepseek系统现在能够区分用户衣橱中已有的单品和建议购买的新单品，提供更为全面的穿搭建议：

1. **明确标识**：每件推荐的单品都会被明确标识为"[衣橱已有]"或"[建议购买]"
2. **衣橱状态分析**：为每件单品提供详细的衣橱状态分析，说明为什么系统认为该单品存在或不存在于用户衣橱中
3. **购买建议**：对于推荐购买的单品，系统会提供预算友好的购买建议，包括价格范围和购买要点
4. **价值分析**：解释新单品如何提升整体衣橱价值和搭配可能性

这项功能使用Deepseek API能够获得更精确的判断和更个性化的建议。如果不使用API，系统也会通过示例回答展示此功能的效果。

## 准备工作

在开始集成 API 之前，您需要：

1. 拥有一个 Deepseek 账户
2. 获取 API 密钥（API Key）
3. 了解 API 的使用限制和费用

## 获取 API 密钥

如果您还没有 Deepseek API 密钥，请按照以下步骤获取：

1. 访问 [Deepseek 官网](https://deepseek.com)（请替换为实际的 Deepseek 官网地址）
2. 注册或登录您的账户
3. 导航至 API 密钥管理页面
4. 创建一个新的 API 密钥
5. 复制并安全保存您的 API 密钥

## 配置 API 密钥

Stylist4deepseek 提供了多种方式配置 API 密钥：

### 方法一：环境变量文件（推荐）

1. 在项目根目录中，复制 `.env.template` 文件并重命名为 `.env`：
   ```bash
   cp .env.template .env
   ```

2. 编辑 `.env` 文件，填入您的 API 密钥：
   ```
   DEEPSEEK_API_KEY=your_actual_api_key_here
   USE_DEEPSEEK_API=true
   ```

3. 保存文件。`.env` 文件不会被提交到版本控制系统，确保您的 API 密钥安全。

### 方法二：命令行参数

在使用命令行版本时，您可以直接通过参数提供 API 密钥：

```bash
python stylist_app.py --api-key your_api_key --use-api
```

### 方法三：Web 界面配置

在使用 Web 应用时，您可以通过界面配置 API 密钥：

1. 启动 Web 应用：`python webapp.py`
2. 打开浏览器访问：http://localhost:5000
3. 点击"高级设置"开关
4. 在 API 密钥字段中输入您的密钥
5. 打开"使用 Deepseek API"开关
6. 使用应用正常提交穿搭需求

## API 模型参数自定义

如果您需要自定义 API 调用的参数，如模型选择、温度等，可以编辑 `deepseek_client.py` 文件中的 `generate_completion` 方法。

默认参数设置如下：
- 模型: `deepseek-chat`（可能需要根据实际可用模型调整）
- 最大令牌数: 2000
- 温度: 0.7（控制回答的随机性，较低的值使回答更确定）

## 测试 API 集成

配置完成后，您可以通过以下方式测试 API 集成是否成功：

```bash
python deepseek_client.py
```

如果配置正确，您应该能看到 API 返回的简单穿搭建议。

## 故障排除

如果在使用 API 时遇到问题，请尝试以下解决方案：

1. **API 密钥不正确**：确保您输入了正确的 API 密钥，没有多余的空格或换行符
2. **网络问题**：确保您的网络可以连接到 Deepseek API 服务器
3. **API 限制**：检查是否达到了 API 调用的限制或配额
4. **响应超时**：对于复杂的查询，API 可能需要更长的时间，尝试简化请求

如果问题仍然存在，您可以查看应用日志或联系 Deepseek 技术支持。

## 安全注意事项

API 密钥是敏感信息，请注意以下安全建议：

1. 不要在公共代码库中分享您的 API 密钥
2. 不要将 `.env` 文件提交到版本控制系统
3. 定期轮换您的 API 密钥
4. 设置适当的使用限制，防止意外费用

## 成本控制

使用 API 可能会产生费用，具体取决于 Deepseek 的定价策略。请注意以下成本控制措施：

1. 监控您的 API 使用情况和费用
2. 在开发和测试时，使用较低的请求频率
3. 使用 `max_tokens` 参数控制响应长度
4. 当不需要精确的穿搭建议时，可以关闭 API 使用，改为示例回答 